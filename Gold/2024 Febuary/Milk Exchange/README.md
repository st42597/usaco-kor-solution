몇가지 관찰이 필요합니다. 먼저 이 문제를 x분이 흐른 뒤에 $a_i$와 같은 값을 가지는 인덱스를 생각했을 때 $i$, $(i+1)$, ... $(i+x)$번째 인덱스의 값이 $a_i$가 될 수 있습니다.

위 사실을 이용하여 $x$분 후에 $a_i$를 가지는 위치의 갯수를 빠르게 구하는 문제로 바꿀 수 있는데, $a_i$보다 작은 값이 덮어씌우는 것을 고려해야 합니다.

이를 구하기 위해 고려해야하는 것은 $i$에서 가장 가까운 왼쪽 위치 $l$, 가장 가까운 오른쪽 위치 $r$이며 ($i$에서 $l$까지의 거리) - 1과 ($i$에서 $r$까지의 거리) - 1에 따라서 정해집니다. 그 중 작은 값을 $d_1$, 큰 값을 $d_2$라고 하면 지난 시간에 따른 $a_i$가 답에 기여하는 정도에 대한 그래프는 다음과 같습니다.

![image](https://github.com/kig9981/usaco-kor-solution/assets/37627118/d762b4f1-1d7f-4547-9026-179a639e49ed)

위를 바탕으로 모든 $i$에 대한 합을 각 시간에 대하여 구해주면 되고, 전부 일차함수꼴이기 때문에 prefix sum등의 자료구조를 이용하여 구할 수 있습니다. $i$를 $a_i$가 작은 순으로 정렬한 뒤 위의 방법을 통해 순서대로 구하는 시간복잡도는 $O(NlogN)$입니다.